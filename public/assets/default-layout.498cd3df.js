var Fe=Object.defineProperty,Te=Object.defineProperties;var De=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var oe=(r,o,a)=>o in r?Fe(r,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[o]=a,N=(r,o)=>{for(var a in o||(o={}))re.call(o,a)&&oe(r,a,o[a]);if(U)for(var a of U(o))ae.call(o,a)&&oe(r,a,o[a]);return r},ne=(r,o)=>Te(r,De(o));var te=(r,o)=>{var a={};for(var c in r)re.call(r,c)&&o.indexOf(c)<0&&(a[c]=r[c]);if(r!=null&&U)for(var c of U(r))o.indexOf(c)<0&&ae.call(r,c)&&(a[c]=r[c]);return a};import{a as K,c as ue,_ as R,u as se,b as j,e as Ee,f as Ie,h as Re,i as de,l as me,j as pe}from"./index.b69ae5d8.js";import{F as je}from"./index.905827ea.js";import{aV as Ae,d as I,C as v,aE as w,aH as t,D as E,aJ as Q,F as G,G as f,aI as n,aN as M,aO as F,aK as X,aW as Z,b8 as ge,bO as Ne,bm as Pe,bP as Ue,bQ as Oe,bR as Ve,e as T,r as Ke,t as We,c as y,u as g,aF as D,bd as qe,bB as He,bC as Je,bE as Ye,i as Ge,aL as B,bD as Qe,aU as Xe,bS as Ze,bT as eo,bU as oo,bF as ro,bV as ao,bk as no,bW as to,bX as co,bY as io,h as O,bZ as V,b_ as lo,b$ as uo,w as he,E as be,c0 as so,ba as mo,bb as po,c1 as go,o as ho,c2 as bo,c3 as vo,c4 as ce,c5 as fo,c6 as xo,p as _o,bf as ko,c7 as yo,c8 as wo,aY as zo,c9 as Co,ca as $o}from"./arco.2630271b.js";import{f as P,i as Lo,j as So,k as Bo,h as ve,l as Mo}from"./vue.566aa562.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{u as Fo}from"./loading.d26cebd8.js";/* empty css              *//* empty css              */import{s as ie,c as J,a as Y}from"./customernum.892a0c1c.js";import"./chart.4c1dd9de.js";function To(){const r=P(),o=K();return{logout:async c=>{await o.logout();const s=r.currentRoute.value;Ae.success("\u767B\u51FA\u6210\u529F"),r.push({name:c&&typeof c=="string"?c:"login",query:ne(N({},r.currentRoute.value.query),{redirect:s.name})})}}}function Do(){return ue.get("/api/message/unreadlist")}function Eo(r){return ue.post("/api/message/read",r)}const Io={class:"item-wrap"},Ro=M(" \u53BB\u8DDF\u8FDB "),jo=I({__name:"list",props:{renderList:{type:Array,required:!0},unreadCount:{type:Number,default:0}},emits:["itemClick"],setup(r,{emit:o}){const a=P(),c=u=>{u.status||o("itemClick",[u])},s=u=>{c(u);const x=a.resolve({name:"CustomerEdit",params:{id:u.custom_id}});window.open(x.href,"_blank")};return(u,x)=>{const d=Z,C=ge,i=Ne,k=Pe,z=Ue,l=Oe,h=Ve;return v(),w(h,{bordered:!1},{default:t(()=>[(v(!0),E(X,null,Q(r.renderList,m=>(v(),w(l,{key:m.id,"action-layout":"vertical",style:G({opacity:m.status?.5:1})},{default:t(()=>[f("div",Io,[n(z,null,{title:t(()=>[n(C,{size:4},{default:t(()=>[f("span",null,[M(F(m.title)+" ",1),n(d,{type:"text",size:"small",onClick:e=>s(m)},{default:t(()=>[Ro]),_:2},1032,["onClick"])])]),_:2},1024)]),description:t(()=>[f("div",null,[n(i,{ellipsis:{rows:1}},{default:t(()=>[M(F(m.content),1)]),_:2},1024),n(k,{class:"time-text"},{default:t(()=>[M(F(m.time),1)]),_:2},1024)])]),_:2},1024)])]),_:2},1032,["style"]))),128))]),_:1})}}});var Ao=R(jo,[["__scopeId","data-v-6be5c938"]]);const No=M(" \u5168\u90E8\u5DF2\u8BFB "),Po=M(" \u67E5\u770B\u66F4\u591A "),Uo=I({__name:"index",setup(r){const o=K(),{loading:a,setLoading:c}=Fo(!0),s=T("notice");se();const u=Ke({renderList:[],messageList:[]});We(u);const x=[{key:"notice",title:"\u5F85\u529E\u65E5\u7A0B"}];async function d(){c(!0);try{const{data:e}=await Do();o.noticeCount=e.length,u.messageList=e}catch{}finally{c(!1)}}async function C(e){const p=e.map(b=>b.id);await Eo({ids:p}),d()}const i=y(()=>u.messageList.filter(e=>s.value===e.type)),k=y(()=>i.value.filter(e=>!e.status).length),z=e=>u.messageList.filter(b=>b.type===e&&!b.status),l=e=>{const p=z(e);return p.length?`(${p.length})`:""},h=e=>{i.value.length&&C([...e])},m=()=>{C(u.messageList)};return d(),(e,p)=>{const b=qe,_=He,L=Z,$=Je,A=Ye;return v(),w(A,{style:{display:"block"},loading:g(a)},{default:t(()=>[n($,{activeKey:s.value,"onUpdate:activeKey":p[1]||(p[1]=S=>s.value=S),type:"rounded","destroy-on-hide":""},{extra:t(()=>[n(L,{type:"text",onClick:m},{default:t(()=>[No]),_:1}),n(L,{type:"text",onClick:p[0]||(p[0]=S=>e.$router.push({name:"NoticeList"}))},{default:t(()=>[Po]),_:1})]),default:t(()=>[(v(),E(X,null,Q(x,S=>n(_,{key:S.key},{title:t(()=>[f("span",null,F(S.title)+F(l(S.key)),1)]),default:t(()=>[g(i).length?D("",!0):(v(),w(b,{key:0,status:"404"},{subtitle:t(()=>[M(F(e.$t("messageBox.noContent")),1)]),_:1})),n(Ao,{"render-list":g(i),"unread-count":g(k),onItemClick:h},null,8,["render-list","unread-count"])]),_:2},1024)),64))]),_:1},8,["activeKey"])]),_:1},8,["loading"])}}});var Oo=R(Uo,[["__scopeId","data-v-e30bbb98"]]);const Vo={class:"navbar"},Ko={class:"left-side"},Wo=M(" CRM\u5BA2\u6237\u7BA1\u7406\u7CFB\u7EDF "),qo={class:"right-side"},Ho=M(" \u5728\u7EBF "),Jo=M(" \u79BB\u7EBF "),Yo={class:"message-box-trigger"},Go=["src"],Qo={style:{"text-align":"center"}},Xo=I({__name:"index",setup(r){const o=j(),a=K(),{logout:c}=To();Ee();const{isFullscreen:s,toggle:u}=Lo(),x=y(()=>a.avatar),d=T(a.online),C=y(()=>a.noticeCount),i=y(()=>o.theme),k=So({selector:"body",attribute:"arco-theme",valueDark:"dark",valueLight:"light",storageKey:"arco-theme",onChanged(_){o.toggleTheme(_)}}),z=Bo(k),l=()=>{z()},h=T();T();const m=()=>{const _=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});h.value.dispatchEvent(_)},e=()=>{c()},p=async()=>{await a.switchOnlineProxy(d.value)},b=Ge("toggleDrawerMenu");return(_,L)=>{const $=Qe,A=B("icon-menu-fold"),S=ge,fe=Xe,xe=B("icon-notification"),W=Z,_e=Ze,q=eo,ke=oo,ye=B("icon-moon-fill"),we=B("icon-sun-fill"),ze=B("icon-fullscreen-exit"),Ce=B("icon-fullscreen"),$e=ro,H=ao,Le=no,Se=B("icon-settings"),Be=B("icon-export"),Me=to;return v(),E("div",Vo,[f("div",Ko,[n(S,null,{default:t(()=>[n($,{style:{margin:0,fontSize:"18px"},heading:5},{default:t(()=>[Wo]),_:1}),g(o).device==="mobile"?(v(),w(A,{key:0,style:{"font-size":"22px",cursor:"pointer"},onClick:g(b)},null,8,["onClick"])):D("",!0)]),_:1})]),f("ul",qo,[f("li",null,[n(fe,{modelValue:d.value,"onUpdate:modelValue":L[0]||(L[0]=ee=>d.value=ee),onChange:p},{checked:t(()=>[Ho]),unchecked:t(()=>[Jo]),_:1},8,["modelValue"])]),f("li",null,[n(q,{content:_.$t("settings.navbar.alerts")},{default:t(()=>[f("div",Yo,[n(_e,{count:g(C)},{default:t(()=>[n(W,{class:"nav-btn",type:"outline",shape:"circle",onClick:m},{default:t(()=>[n(xe)]),_:1})]),_:1},8,["count"])])]),_:1},8,["content"]),n(ke,{trigger:"click","arrow-style":{display:"none"},"content-style":{padding:0,minWidth:"440px"},"content-class":"message-popover"},{content:t(()=>[n(Oo)]),default:t(()=>[f("div",{ref_key:"refBtn",ref:h,class:"ref-btn"},null,512)]),_:1})]),f("li",null,[n(q,{content:g(i)==="light"?_.$t("settings.navbar.theme.toDark"):_.$t("settings.navbar.theme.toLight")},{default:t(()=>[n(W,{class:"nav-btn",type:"outline",shape:"circle",onClick:l},{icon:t(()=>[g(i)==="dark"?(v(),w(ye,{key:0})):(v(),w(we,{key:1}))]),_:1})]),_:1},8,["content"])]),f("li",null,[n(q,{content:g(s)?_.$t("settings.navbar.screen.toExit"):_.$t("settings.navbar.screen.toFull")},{default:t(()=>[n(W,{class:"nav-btn",type:"outline",shape:"circle",onClick:g(u)},{icon:t(()=>[g(s)?(v(),w(ze,{key:0})):(v(),w(Ce,{key:1}))]),_:1},8,["onClick"])]),_:1},8,["content"])]),f("li",null,[n(Me,{trigger:"click"},{content:t(()=>[n(H,null,{default:t(()=>[f("div",Qo," \u4F60\u597D, "+F(g(a).name)+"\uFF01 ",1)]),_:1}),n(Le,{style:{margin:"4px 0px"}}),n(H,null,{default:t(()=>[n(S,{onClick:L[1]||(L[1]=ee=>_.$router.push({name:"Usersetting"}))},{default:t(()=>[n(Se),f("span",null,F(_.$t("messageBox.userSettings")),1)]),_:1})]),_:1}),n(H,null,{default:t(()=>[n(S,{onClick:e},{default:t(()=>[n(Be),f("span",null,F(_.$t("messageBox.logout")),1)]),_:1})]),_:1})]),default:t(()=>[n($e,{size:32,style:{marginRight:"8px",cursor:"pointer"}},{default:t(()=>[f("img",{alt:"avatar",src:g(x)},null,8,Go)]),_:1})]),_:1})])])])}}});var Zo=R(Xo,[["__scopeId","data-v-071a404d"]]);const er=(r,o)=>{const s=o||{},{target:a="_blank"}=s,c=te(s,["target"]);window.open(r,a,Object.entries(c).reduce((u,x)=>{const[d,C]=x;return[...u,`${d}=${C}`]},[]).join(","))},or=new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i"),rr=[...Ie,...Re],ar=rr.map(r=>{const{name:o,path:a,meta:c,redirect:s,children:u}=r;return{name:o,path:a,meta:c,redirect:s,children:u}});function nr(){const r=de(),o=j(),a=y(()=>o.menuFromServer?o.appAsyncMenus:ar);return{menuTree:y(()=>{const s=JSON.parse(JSON.stringify(a.value));s.sort((x,d)=>(x.meta.order||0)-(d.meta.order||0));function u(x,d){return x?x.map(i=>{var z,l;if(!r.accessRouter(i))return null;if(((z=i.meta)==null?void 0:z.hideChildrenInMenu)||!i.children)return i.children=[],i;i.children=i.children.filter(h=>{var m;return((m=h.meta)==null?void 0:m.hideInMenu)!==!0});const k=u(i.children,d+1);return k.length||d>1?(i.children=k,i):((l=i.meta)==null?void 0:l.hideInMenu)===!1?i:null}).filter(Boolean):null}return u(s,0)})}}function tr(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!co(r)}var cr=I({emit:["collapse"],setup(){const{t:r}=se(),o=j(),a=P(),c=ve(),{menuTree:s}=nr(),u=y({get(){return o.device==="desktop"?o.menuCollapse:!1},set(l){o.updateSettings({menuCollapse:l})}}),x=T([]),d=T([]);ie(),setInterval(function(){ie()},1e4);const C=l=>{if(or.test(l.path)){er(l.path),d.value=[l.name];return}const{hideInMenu:h,activeMenu:m}=l.meta;if(c.name===l.name&&!h&&!m){d.value=[l.name];return}a.push({name:l.name})},i=l=>{const h=[];let m=!1;const e=(p,b,_)=>{var L;if(p.name===_){m=!0,h.push(...b,p.name);return}(L=p.children)!=null&&L.length&&p.children.forEach($=>{e($,[...b],_)})};return s.value.forEach(p=>{m||e(p,[p.name],l)}),h};me(l=>{const{requiresAuth:h,activeMenu:m,hideInMenu:e}=l.meta;if(!e||m){const p=i(m||l.name),b=new Set([...p,...x.value]);x.value=[...b],d.value=[m||p[p.length-1]]}},!0);const k=l=>{o.device==="desktop"&&o.updateSettings({menuCollapse:l})},z=()=>{function l(h,m=[]){return h&&h.forEach(e=>{var L;const p=(L=e==null?void 0:e.meta)!=null&&L.icon?()=>{var $;return O(V(`<${($=e==null?void 0:e.meta)==null?void 0:$.icon}/>`))}:null,b=T();(e==null?void 0:e.name)==="CustomerNewList"&&J.value>0?b.value=O(V(`<span style="padding: 0px; font-size: 12px; line-height: 20px; height: 20px; background: red; border-radius: 10px; color: #fff; margin-left: 10px; min-width: 20px; display: inline-block; text-align: center; font-weight: bold;">${J.value>99?"99+":J.value}</span>`)):(e==null?void 0:e.name)==="ApproveOther"&&Y.value>0?b.value=O(V(`<span style="padding: 0px; font-size: 12px; line-height: 20px; height: 20px; background: red; border-radius: 10px; color: #fff; margin-left: 10px; min-width: 20px; display: inline-block; text-align: center; font-weight: bold;">${Y.value>99?"99+":Y.value}</span>`)):b.value=null;const _=(e==null?void 0:e.children)&&(e==null?void 0:e.children.length)!==0?n(lo,{key:e==null?void 0:e.name},{default:()=>[l(e==null?void 0:e.children)],icon:p,title:()=>{var $;return O(V(r((($=e==null?void 0:e.meta)==null?void 0:$.locale)||"")))}}):n(uo,{key:e==null?void 0:e.name,onClick:()=>C(e)},{default:()=>{var $;return[r((($=e==null?void 0:e.meta)==null?void 0:$.locale)||""),b.value]},icon:p});m.push(_)}),m}return l(s.value)};return()=>{let l;return n(io,{collapsed:u.value,"onUpdate:collapsed":h=>u.value=h,theme:"dark","show-collapse-button":o.device!=="mobile","auto-open":!0,"selected-keys":d.value,"auto-open-selected":!0,"level-indent":34,style:"height: 100%",onCollapse:k},tr(l=z())?l:{default:()=>[l]})}}});var le=R(cr,[["__scopeId","data-v-bcd22dce"]]);const ir=r=>(mo("data-v-4e2b11ca"),r=r(),po(),r),lr={class:"tab-bar-container"},ur={class:"tab-bar-box"},sr={class:"tab-bar-scroll"},dr={class:"tags-wrap"},mr=["onClick"],pr={class:"tag-link"},gr=["onClick"],hr=ir(()=>f("div",{class:"tag-bar-operation"},null,-1)),br=I({__name:"index",setup(r){const o=j(),a=pe(),c=P(),s=T(),u=y(()=>a.getTabList),x=y(()=>o.navbar?60:0);he(()=>o.navbar,()=>{s.value.updatePosition()}),me(i=>{!i.meta.noAffix&&!u.value.some(k=>k.fullPath===i.fullPath)&&a.updateTabList(i)},!0);const d=(i,k)=>{if(a.deleteTag(k,i),k===u.value.length){const z=u.value[u.value.length-1];c.push({name:z.name})}},C=i=>{c.push(N({},i))};return(i,k)=>{const z=B("icon-close"),l=go;return v(),E("div",lr,[n(l,{ref_key:"affixRef",ref:s,"offset-top":g(x)},{default:t(()=>[f("div",ur,[f("div",sr,[f("div",dr,[(v(!0),E(X,null,Q(g(u),(h,m)=>(v(),E("span",{key:h.fullPath,class:be(["arco-tag arco-tag-size-medium arco-tag-checked",{"link-activated":h.fullPath===i.$route.fullPath}]),onClick:e=>C(h)},[f("span",pr,F(i.$t(h.title)),1),f("span",{class:"arco-icon-hover arco-tag-icon-hover arco-icon-hover-size-medium arco-tag-close-btn",onClick:so(e=>d(h,m),["stop"])},[n(z)],8,gr)],10,mr))),128))])]),hr])]),_:1},8,["offset-top"])])}}});var vr=R(br,[["__scopeId","data-v-4e2b11ca"]]);function fr(r,o,a,c=!1){r.addEventListener&&typeof r.addEventListener=="function"&&r.addEventListener(o,a,c)}function xr(r,o,a,c=!1){r.removeEventListener&&typeof r.removeEventListener=="function"&&r.removeEventListener(o,a,c)}const _r=992;function kr(){return document.body.getBoundingClientRect().width-1<_r}function yr(r){const o=j();function a(){if(!document.hidden){const s=kr();o.toggleDevice(s?"mobile":"desktop"),o.toggleMenu(s)}}const c=Mo(a,100);ho(()=>{r&&c()}),bo(()=>{fr(window,"resize",c)}),vo(()=>{xr(window,"resize",c)})}const wr=I({__name:"page-layout",setup(r){const o=pe(),a=y(()=>o.getCacheList);return(c,s)=>{const u=B("router-view");return v(),w(u,null,{default:t(({Component:x,route:d})=>[n(xo,{name:"fade",mode:"out-in",appear:""},{default:t(()=>[d.meta.ignoreCache?(v(),w(ce(x),{key:d.fullPath})):(v(),w(fo,{key:1,include:g(a)},[(v(),w(ce(x),{key:d.fullPath}))],1032,["include"]))]),_:2},1024)]),_:1})}}});const zr={key:0,class:"layout-navbar"},Cr={class:"menu-wrapper"},$r=I({__name:"default-layout",setup(r){const o=j(),a=K(),c=P(),s=ve(),u=de();yr(!0);const x="60px",d=y(()=>o.navbar),C=y(()=>o.menu),i=y(()=>o.hideMenu),k=y(()=>o.footer),z=y(()=>o.menuCollapse?48:o.menuWidth),l=y(()=>o.menuCollapse),h=y(()=>{const b=C.value&&!i.value?{paddingLeft:`${z.value}px`}:{},_=d.value?{paddingTop:x}:{};return N(N({},b),_)}),m=b=>{o.updateSettings({menuCollapse:b})};he(()=>a.role,b=>{b&&!u.accessRouter(s)&&c.push({name:"notFound"})});const e=T(!1),p=()=>{e.value=!1};return _o("toggleDrawerMenu",()=>{e.value=!e.value}),(b,_)=>{const L=wo,$=zo,A=Co,S=$o;return v(),w(S,{class:be(["layout",{mobile:g(o).hideMenu}])},{default:t(()=>[g(d)?(v(),E("div",zr,[n(Zo)])):D("",!0),n(S,null,{default:t(()=>[n(S,null,{default:t(()=>[g(C)?ko((v(),w(L,{key:0,class:"layout-sider",breakpoint:"xl",collapsed:g(l),collapsible:!0,width:g(z),style:G({paddingTop:g(d)?"60px":""}),"hide-trigger":!0,onCollapse:m},{default:t(()=>[f("div",Cr,[n(le)])]),_:1},8,["collapsed","width","style"])),[[yo,!g(i)]]):D("",!0),g(i)?(v(),w($,{key:1,visible:e.value,placement:"left",footer:!1,"mask-closable":"",closable:!1,onCancel:p},{default:t(()=>[n(le)]),_:1},8,["visible"])):D("",!0),n(S,{class:"layout-content",style:G(g(h))},{default:t(()=>[g(o).tabBar?(v(),w(vr,{key:0})):D("",!0),n(A,null,{default:t(()=>[n(wr)]),_:1}),g(k)?(v(),w(je,{key:1})):D("",!0)]),_:1},8,["style"])]),_:1})]),_:1})]),_:1},8,["class"])}}});var qr=R($r,[["__scopeId","data-v-56ba01a2"]]);export{qr as default};
